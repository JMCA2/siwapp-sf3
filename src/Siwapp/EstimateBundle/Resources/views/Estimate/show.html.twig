{% extends "SiwappCoreBundle::base.html.twig" %}
{% trans_default_domain 'SiwappEstimateBundle' %}

{% block stylesheets %}
  {{ parent() }}
  {% stylesheets
    'bundles/siwappinvoice/css/invoice.css'
    filter='cssrewrite'
    filter='?yui_css'
  %}
    <link rel="stylesheet" href="{{ asset_url }}" />
  {% endstylesheets %}
{% endblock %}

{% block actionlink %}
<a href="{{ path('estimate_add') }}" class="btn btn-default btn-primary">
  <span class="glyphicon glyphicon-plus"></span>
  {% trans %}menu.estimate_add{% endtrans %}
</a>
{% endblock %}

{% block searchform %}{% endblock %}

{% block body %}
  <article class="invoice-like">

    <header id="invoice-like-title">
      <ul class="entity-actions list-inline float-right">
        <li><a class="btn btn-default btn-info" href="{{ path('estimate_show_pdf', {'id': entity.id}) }}"><span class="glyphicon glyphicon-download-alt"></span> {% trans %}show.pdf{% endtrans %}</a></li>
        <li><a class="btn btn-default btn-info" href="{{ path('estimate_show_print', {'id': entity.id}) }}" target="_blank"><span class="glyphicon glyphicon-print"></span> {% trans %}show.print{% endtrans %}</a></li>
        <li><form action="{{ path('estimate_email', {'id': entity.id}) }}" method="post">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">
          <button type="submit" class="btn btn-default btn-warning"><span class="glyphicon glyphicon-envelope"></span> {%trans %}show.email{% endtrans %}</button>
          </form>
        </li>
        <li><form action="{{ path('estimate_generate_invoice', {'id': entity.id}) }}" method="post">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">
          <button type="submit" class="btn btn-default btn-warning"><span class="glyphicon glyphicon-file"></span> {% trans %}show.generate_invoice{% endtrans %}</button>
          </form></li>
      </ul>

      <h2>Estimate {{ entity.label() }}</h2>
      <ul class="list-inline list-unstyled">
        <li>
          <span class="label {{ entity.statusString }}">{{ entity.statusString|capitalize }}</span>
        </li>
        <li>
          {% if entity.sentByEmail %}
          <span class="label notice">{% trans %}estimate.sent_by_email{% endtrans %}</span>
          {% else %}
          <span class="label">{% trans %}estimate.not_sent_by_email{% endtrans %}</span>
          {% endif %}
        </li>
      </ul>
    </header>

    <div class="row">
      <div id="invoice-like-customer-data" class="col-md-8">

        <h3>{% trans %}show.customer{% endtrans %}</h3>

        <div class="row">
          <div class="col-md-6 clearfix">
            <label>{% trans %}show.customer_name{% endtrans %}:</label>
            {{ entity.customer_name }}
          </div>
          <div class="col-md-6 clearfix">
            <label>{% trans %}show.customer_identification{% endtrans %}:</label>
            {{ entity.customer_identification }}
          </div>
          <div class="col-md-6 clearfix">
            <label>{% trans %}show.contact_person{% endtrans %}:</label>
            {{ entity.contact_person}}
          </div>

          <div class="col-md-6 clearfix">
            <label>{% trans %}show.customer_email{% endtrans %}:</label>
            <a href="mailto:{{ entity.customer_email }}">{{ entity.customer_email }}</a>
          </div>

          <div class="col-md-6 clearfix">
            <label>{% trans %}show.invoicing_address{% endtrans %}:</label>
            <p>{{ entity.invoicing_address|nl2br }}</p>
          </div>
          <div class="col-md-6 clearfix">
            <label>{% trans %}show.shipping_address{% endtrans %}:</label>
            <p>{{ entity.shipping_address|nl2br }}</p>
          </div>
        </div>
      </div>

      <div id="invoice-like-properties" class="col-md-4"><div class="panel panel-default">
        <h3 class="panel-heading">{% trans %}show.properties{% endtrans %}</h3>

        <div class="panel-body">
          <div class="col-md-12">
            <label>{% trans %}show.series{% endtrans %}:</label>
            {{ entity.series }}
          </div>
          <div class="col-md-12">
            <label>{% trans %}show.issue_date{% endtrans %}:</label>
            {{ entity.issue_date|localizeddate('medium', 'none') }}
          </div>
          <div class="col-md-12">
            <label>{% trans %}show.status{% endtrans %}:</label>
            {{ entity.status }}
          </div>
        </div>
      </div></div>
    </div>

    <div class="row">
      <div class="col-md-12">

        <h3>{% trans %}show.items{% endtrans %}</h3>

        <table id="invoice-like-items" class="table table-condensed table-striped align-middle">
          <thead>
            <tr>
              <th class="">{% trans from 'SiwappCoreBundle' %}item.show.description{% endtrans %}</th>
              <th class="col-md-1 cell-align-center">{% trans from 'SiwappCoreBundle' %}item.show.quantity{% endtrans %}</th>
              <th class="col-md-2 cell-align-center">{% trans from 'SiwappCoreBundle' %}item.show.unitary_cost{% endtrans %}</th>
              <th class="col-md-1 cell-align-center">{% trans from 'SiwappCoreBundle' %}item.show.discount{% endtrans %}</th>
              <th class="col-md-2 cell-align-left">{% trans from 'SiwappCoreBundle' %}item.show.taxes{% endtrans %}</th>
              <th colspan="2" class="cell-align-right">{% trans from 'SiwappCoreBundle' %}item.show.total{% endtrans %}</th>
            </tr>
          </thead>
          <tbody>
            {% for item in entity.items %}
              {{ include('SiwappCoreBundle:Item:show.html.twig', { 'item': item, 'currency': currency }) }}
            {% endfor %}
          </tbody>
        </table>

      </div>
    </div>

    <div class="row totals">
      <div class="col-md-4 col-md-offset-8">
        <table id="invoice-like-totals" class="table table-condensed table-striped">
          <tbody>
            <tr>
              <th class="cell-size-large">{% trans %}show.subtotal{% endtrans %}</th>
              <td class="cell-align-right">{{ entity.baseAmount|localizedcurrency(currency) }}</td>
            </tr>
            <tr>
              <th>{% trans %}show.total_taxes{% endtrans %}</th>
              <td class="cell-align-right">{{ entity.taxAmount|localizedcurrency(currency) }}</td>
            </tr>
            <tr>
              <th>{% trans with {'%currency%': currency} %}show.total{% endtrans %}</th>
              <td class="cell-align-right">{{ entity.grossAmount|localizedcurrency(currency) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="invoice-like-notes" class="row">
      <div class="col-md-6">
        <label>{% trans %}show.terms{% endtrans %}:</label>
        <p>{{ entity.terms|nl2br }}</p>
      </div>
      <div class="col-md-6">
        <label>{% trans %}show.notes{% endtrans %}:</label>
        <p>{{ entity.notes|nl2br }}</p>
      </div>
    </div>

    <div class="entity-actions clearfix">
      <ul class="list-inline float-right">
        <li><a class="btn btn-default" href="{{ path('estimate_edit', {'id': entity.id}) }}"><span class="glyphicon glyphicon-pencil"></span> {% trans %}show.edit{% endtrans %}</a></li>
        <li><a class="btn btn-default btn-danger" href="{{ path('estimate_delete', {'id': entity.id}) }}"><span class="glyphicon glyphicon-trash"></span> {% trans %}show.delete{% endtrans %}</a></li>
      </ul>
    </div>

  </article>
{% endblock %}
